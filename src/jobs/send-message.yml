description: >
  Send a message to keybase team channel
# What will this job do?

executor: default

parameters:
  team_name:
    type: string
    description: "Team to send notification"
  channel_topic:
    type: string
    description: "Channel of the team to send notification"
  message:
    type: string
    description: "Message to send to the keybase"
  only_on_fail:
    type: boolean
    description: "Whether to send notification only after a failure"
    default: true
steps:
  - unless:
      condition: << parameters.only_on_fail >>
      steps:
        - run:
          environment:
            CHANNEL_NAME: <<parameters.team_name>>
            CHANNEL_TOPIC: <<parameters.channel_topic>>
            CUSTOM_MESSAGE: <<parameters.message>>
          name: Message Build
          command: <<include(scripts/build_message_api.sh)>>
          when: on_sucess
        - run:
          environment:
            CHANNEL_NAME: <<parameters.team_name>>
            CHANNEL_TOPIC: <<parameters.channel_topic>>
            CUSTOM_MESSAGE: <<parameters.message>>
          name: Sending Message
          command: <<include(scripts/send_message_api.sh)>>
          when: on_sucess
  - run:
      environment:
        CHANNEL_NAME: <<parameters.team_name>>
        CHANNEL_TOPIC: <<parameters.channel_topic>>
        CUSTOM_MESSAGE: <<parameters.message>>
      name: Message Build
      command: <<include(scripts/build_message_api.sh)>>
      when: on_fail
  - run:
      environment:
        CHANNEL_NAME: <<parameters.team_name>>
        CHANNEL_TOPIC: <<parameters.channel_topic>>
        CUSTOM_MESSAGE: <<parameters.message>>
      name: Sending Message
      command: <<include(scripts/send_message_api.sh)>>
      when: on_fail
